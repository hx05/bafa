
<head>
  <title>SKADEC Förderrechner</title>
    <style>    
    body {
  -webkit-font-smoothing: antialiased;
  text-align: left;
  font-weight: 400;
  line-height: 1.5;
  color: #00689e;
  font-size: 12pt;
  Font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
}

table {
    border-collapse: separate;
    border-spacing: 0;
    display: flex; 
    width:99%;
}

tfoot tr:last-child td:first-child {
  border-bottom-left-radius:3px;
}

tfoot tr:last-child td:last-child {
  border-bottom-right-radius:3px;
}

thead tr:first-child th:first-child,
thead tr:first-child td:first-child {
  border-top-left-radius:3px
}

thead tr:first-child th:last-child,
thead tr:first-child td:last-child {
  border-top-right-radius:3px
}


td,
th {
    display: table-cell;
    margin: 0;
    padding: 0.3em;
    border: 1px solid #000000;
}

tbody {
  font-size: 90%;
  color: #00689e
}


tbody tr td:first-child, tbody tr td:last-child {
  text-align: center;
  vertical-align: baseline;
  font-weight: bold;
  font-size: 120%;
}

tfoot td {
  font-weight: bold;
  padding: 0.5em;
  font-size: 90%;
}



.tooltipbafa {
    position: relative;
    cursor: pointer;
    border-bottom: 1px dotted black;
}
  
.tooltipbafa .tooltiptext {
  visibility: hidden;
  width: 300px;
  background-color: rgb(51, 51, 51);
  color: #ffffff;
  border-radius: 2px;
  padding: 10px;
  position: absolute;
  z-index: 10;
  top: 200%;
  left: 50%;
  margin-top: -10px;
  margin-left: 12px;
  font-size: 90%;
}

.tooltipbafa:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
}


/* Toggle this class - hide and show the popup */
.tooltipbafa .show {
  visibility: visible;
  -webkit-animation: fadeIn 1s;
  animation: fadeIn 1s;
}

/* Add animation (fade in the popup) */
@-webkit-keyframes fadeIn {
  from {opacity: 0;} 
  to {opacity: 1;}
}

@keyframes fadeIn {
  from {opacity: 0;}
  to {opacity:1 ;}
}

main {
  padding-bottom: 0.5em;
}

/*
label { 
 padding: 1em;
}
*/


.label {
  clear: both;
  float: left;
  width: 17em !important;
  display: block;
}

.haupttext {
  padding-top: 0.3em;
  padding-bottom: 0.4em;
  line-height: 1.25em;
  margin: 0em 0em 0em 0em
}

.feld {
  padding: 0.2em 0 !important;
}


legend {
  margin: 0;
  padding: 0;
  font-weight: bold;
}

fieldset {
  border: 1px solid #00689e;
  border-radius: 3px;
  padding-left: 1em;
  padding-top: 0.5em;
  margin-bottom: 0.5em;
  margin-top: 1em;
}

a {
  color: #6fb020;
}


p {
  display: block;
  margin-block-start: 0em;
  margin-block-end: 0em;
  margin-inline-start: 0px;
  margin-inline-end: 0px;
}



.inputKlein {
  border: solid 0.1px rgba(0, 0, 0, 0.212);
  border-radius: 1em;
  background-color: rgb(230, 230, 230);
  width: 5em !important;
  padding: 0.5em;
  text-align: center;
  /*transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s;*/
}


select {
  border-radius: 3px;
  font-weight: bold;
  padding: 0.4em;
  margin: 50px;
  width: 150px;
  padding: 5px 35px 5px 5px;
  border: 1px solid #ccc;
  height: 34px;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

.ausgabe {
  float: right;
  width: 28em !important;
  padding: 0.2em 0 0 0;
  display: flex;
  font-weight: bold;
}


div {
  margin-top: 0.4em;
  margin-bottom: 0.4em;
}


/* The container */
.containerCheck {
  display: block;
  position: relative;
  padding-left: 35px;
  margin-bottom: 12px;
  cursor: pointer;
  
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Hide the browser's default radio button */
.containerCheck input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
}

/* Create a custom radio button */
.checkmark {
  position: absolute;
  top: 0;
  left: 0;
  height: 25px;
  width: 25px;
  background-color: rgb(220, 220, 220);
  border-radius: 50%;
}

/* On mouse-over, add a grey background color */
.containerCheck:hover input ~ .checkmark {
  background-color: #ccc;
}

/* When the radio button is checked, add a blue background */
.containerCheck input:checked ~ .checkmark {
  background-color: #2196F3;
}

/* Create the indicator (the dot/circle - hidden when not checked) */
.checkmark:after {
  content: "";
  position: absolute;
  display: none;
}

/* Show the indicator (dot/circle) when checked */
.containerCheck input:checked ~ .checkmark:after {
  display: block;
}

/* Style the indicator (dot/circle) */
.containerCheck .checkmark:after {
 	top: 6px;
	left: 6px;
	width: 13px;
	height: 13px;
	border-radius: 100%;
	background: white;
}



/* Checkbox*/
.containerBox {
  display: block;
  position: relative;
  padding-left: 35px;
  margin-bottom: 12px;
  cursor: pointer;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Hide the browser's default checkbox */
.containerBox input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
  height: 0;
  width: 0;
}


/* Create a custom checkbox */
.checkbox {
  position: absolute;
  top: 0;
  left: 0;
  height: 25px;
  width: 25px;
  background-color: rgb(220, 220, 220);
}

/* On mouse-over, add a grey background color */
.containerBox:hover input ~ .checkbox {
  background-color: #ccc;
}

/* When the checkbox is checked, add a blue background */
.containerBox input:checked ~ .checkbox {
  background-color: #2196F3;
}

/* Create the checkmark/indicator (hidden when not checked) */
.checkbox:after {
  content: "";
  position: absolute;
  display: none;
}

/* Show the checkmark when checked */
.containerBox input:checked ~ .checkbox:after {
  display: block;
}

/* Style the checkmark/indicator */
.containerBox .checkbox:after {
  left: 9px;
  top: 5px;
  width: 5px;
  height: 10px;
  border: solid white;
  border-width: 0 3px 3px 0;
  -webkit-transform: rotate(45deg);
  -ms-transform: rotate(45deg);
  transform: rotate(45deg);
}


input[type=button], input[type=submit], input[type=reset] {
  background-color: #6fb020;
  border: 1px solid transparent;
  color: white;
  padding: 6px 10px;
  text-decoration: none;
  margin: 4px 2px;
  cursor: pointer;
  border-radius: 100px;
}


input[type="text"] {
  display: inline !important;
}


input[type="text"]:focus {
  box-shadow: 0 0 3pt 0.5pt #80bdff;
  outline: none;
}

input[type="text"]:hover {
  background-color: rgb(200, 200, 200);
}


.clearbutton:hover {
  background-color: #00E66E;
}




/* Auswahlliste*/
.custom-select {
    position: relative;
    width: 90%;
    padding: 0;
}

.custom-select select {
  display: none; /*hide original SELECT element: */
}

.select-selected {
  background-color: #f5f5f5;
}

/* Style the arrow inside the select element: */
.select-selected:after {
  position: absolute;
  content: "";
  top: 14px;
  right: 10px;
  width: 0;
  height: 0;
  border: 6px solid transparent;
  border-color: #6fb020 transparent transparent transparent;
}

/* Point the arrow upwards when the select box is open (active): */
.select-selected.select-arrow-active:after {
  border-color: transparent transparent #6fb020 transparent;
  top: 7px;
}

/* style the items (options), including the selected item: */
.select-items div,.select-selected {
  color:#6fb020;
  padding: 8px 16px;
  border: 1px solid transparent;
  border-color: transparent transparent rgba(0, 0, 0, 0.1) transparent;
  cursor: pointer;
}

/* Style items (options): */
.select-items {
  position: absolute;
  background-color: #f5f5f5;
  top: 100%;
  left: 0;
  right: 0;
  z-index: 99;
}

/* Hide the items when the select box is closed: */
.select-hide {
  display: none;
}

.select-items div:hover, .same-as-selected {
  background-color: rgba(0, 0, 0, 0.1);
}

output {
    display: inline;
}

bdi, output {
    unicode-bidi: -webkit-isolate;
}

*, ::after, ::before {
    box-sizing: content-box;
}

/* Evtl. Tooltips verändern: https://wiki.selfhtml.org/wiki/HTML/Universalattribute/data-Attribute#mit_JavaScript */
    </style>
</head>
<body>
<form name="formcalcbafa">
  <fieldset id="BlockAnlage"></fieldset>
  <table id="TableKomponentenSysteme"></table>
  <table id="TableThermischeSpeicher"></table>

  <fieldset id="BlockPlanung" class="fieldblock">
    <legend class="tooltip" onclick="create_tooltip('BlockPlanung1');">Pauschale für die Ausführungsplanung bei stationären Anlagen
        <span class="tooltiptext" id="BlockAnlage407267768">
          Beantragen Sie hier ggf. die Förderung von Planungsleistungen für die Ausführung von Flüssigkeitskühlsätzen (indirekte Systeme) mit mehreren Kühlstellen sowie deren Kombination mit Wärme- und/oder Kältespeichern.
        </span>
    </legend>
        <div class="haupttext">
          <label class="containerBox">
            Ich beantrage zusätzlich eine Pauschalförderung für die Ausführungsplanung von Flüssigkeitskühlsätzen (sog. indirekten Systemen) mit mehreren Kühlstellen, sowie deren Kombination mit Wärme- und/oder Kältespeichern.
            <input id="plan_check" type="checkbox">
            <span class="checkbox"></span>
          </label>
        </div>
  </fieldset>
  <div>
    <output class="ausgabe" style="color: green; font-size: 120%" id="total"></output>
    <output class="ausgabe" style="color: red"></output>
    <br>
  </div>
</form>
<div><strong>Unverbindliche Beispielrechnung.</strong> Die tatsächliche Förderhöhe wird von der BAFA festgelegt</div>
<div>Hinweise und Quellen:</div>
<p>- <a href="https://um.baden-wuerttemberg.de/fileadmin/redaktion/m-um/intern/Dateien/Dokumente/2_Presse_und_Service/Veranstaltungen/Pr%C3%A4sentationen/2018/180620_Gesundheitseinrichtungen/Arain.pdf" target="_blank">Übersicht Programm</a></p>
<p>- <a href="https://www.bafa.de/SharedDocs/Downloads/DE/Energie/kki_fachtechnik_merkblatt.html?nn=8064164" target="_blank">Merkblatt Fachtechnik</a></p>
<p>- <a href="https://www.bafa.de/SharedDocs/Downloads/DE/Energie/kki_merkblatt_abgrenzung.pdf?__blob=publicationFile&v=8" target="_blank">Abgrenzung förderfähige Kosten</a></p>
<p>- <a href="https://www.bundesanzeiger.de/ebanzwww/wexsservlet?page.navid=official_starttoofficial_view_publication&session.sessionid=371d86bc799d397d4aceb3cb765e9df4&fts_search_list.selected=d7f16b657344f903&&fts_search_list.destHistoryId=86267&fundstelle=BAnz_AT_31.01.2019_B2" target="_blank">Richtlinie vom 19.12.18</a></p>
<p>- <a href="https://www.bafa.de/DE/Energie/Energieeffizienz/Klima_Kaeltetechnik/klima_kaeltetechnik_node.html" target="_blank">Hompage der BAFA</a></p>



</body>


<script language="javascript">

    // tables_data.js
/*
Prototype einer neuen Tabelle. Die Tabelle muss im HTML-Teil ueber "<table id="IDDERTABELLE"></table>" eingeleitet werden und wird dann mit den unten stehenden Angaben ueber foerderrechner.js aufgebaut.

var IDDERTABELLE =             {   name:       "Name.der.Tabelle",
                                    hilfe:      "Hilfetext",
                                    option:     ["Text1", "Text2", "Text3"],
                                    artikel:    [
                        
                                                    [
                                                        "NameArtikel.1",
                                                        [   
                                                            "eingabefeld.1.TextVorne", 
                                                            "eingabefeld.1.TextHinten", 
                                                            "eingabefeld.1.max.zeichen", 
                                                            "eingabefeld.1.Hilfetext[oder false]",
                                                            "eingabefeld.1.optinaleDaten1[oder false]",
                                                            "eingabefeld.1.optinaleDaten2",
                                                            "textfeld.name(id).1",
                                                        ],
                                                        [
                                                            "eingabefeld.2.TextVorne", 
                                                            "eingabefeld.2.TextHinten", 
                                                            "eingabefeld.2.max.zeichen", 
                                                            "eingabefeld.2.Hilfetext[oder false]",
                                                            "eingabefeld.2.optinaleDaten1[oder false]",
                                                            "eingabefeld.2.optinaleDaten2",
                                                            "textfeld.name(id).2",
                                                        ],
                                                    ],
                                                        
                                                        
                                                    [
                                                        "optional.NameArtikel.2",
                                                        [
                                                            "eingabefeld.1.TextVorne", 
                                                            "eingabefeld.1.TextHinten", 
                                                            "eingabefeld.1.max.zeichen", 
                                                            "eingabefeld.1.Hilfetext[oder false]",
                                                            "eingabefeld.1.optinaleDaten1[oder false]",
                                                            "eingabefeld.1.optinaleDaten2",
                                                            "textfeld.name(id).1",
                                                        ],
                                                        [
                                                            "eingabefeld.2.TextVorne", 
                                                            "eingabefeld.2.TextHinten", 
                                                            "eingabefeld.2.max.zeichen", 
                                                            "eingabefeld.2.Hilfetext[oder false]",
                                                            "eingabefeld.2.optinaleDaten1[oder false]",
                                                            "eingabefeld.2.optinaleDaten2",
                                                            "textfeld.name(id).2",
                                                        ],                                                      
                                                    ],
                    
                                                ]
                                };

*/

var TableKomponentenSysteme =   {   name:       "Komponenten und Systeme",
                                    hilfe:      "Geben Sie hier bitte die Leistung der Kälte- oder Klimaanlage an, die gefördert werden sollen. Jede Komponente muss mit ihrer jeweiligen Leistung einzeln erfasst werden. Fördervoraussetzung ist, dass die Leistung der ausgewählten Komponente innerhalb der angegebenen Leistungsbereiche liegt. Bei Kühlmöbeln für Supermarkt-Kälteanlagen geben Sie bitte die Länge der Kühlmöbel an. Bei Kühlsoleleitungen geben Sie bitte Länge und Durchschnitt der Rohrleitungen an. Komponenten für Freikühlbetrieb (Ventile, Leitungen, Reglerintegration etc.) können gefördert werden, wenn der Freikühler in der Lage ist, den Kälteleistungsbedarf vollständig zu decken, wenn die Außenlufttemperatur drei Kelvin niedriger ist als die Nutztemperatur.",
                                    option:     [
                                        "Freikühlerbetrieb",
                                        "Ich beantrage die Förderung von Komponenten und Systemen für den Freikühlerbetrieb (Ventile, Leitungen, Reglerintegration etc.).",
                                        "Der / die Freikühler sind in der Lage, den Kälteleistungsbedarf vollständig zu decken, wenn die Außenlufttemperatur drei Kelvin niedriger ist als die Nutztemperatur (TAUL < TNutz - 3 K).",
                                        "Förderhöhe Freikühler: ",
                                    ],
                                    artikel:    [
                        
                                                    [
                                                        "Tiefkühlstufe mit R-744 ",
  
                                                        [
                                                            "Leistung der Verdampfer:", 
                                                            " kW (Q̇₀ = 30,00 bis 120,00 kW)", 
                                                            "6",
                                                            "Geben Sie den Wärmestrom an, der den zu kühlenden Produkten entzogen wird, zuzüglich aller auftretenden Verluste. Die Dimensionierung der Verdampferleistung erfolgt nach dem Kältebedarf. Die Verdampferleistung muss innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                            [30, 120],
                                                            false,
                                                            false,
                                                        ],
                                                        [
                                                            "Kälteleistung:", 
                                                            " kW", 
                                                            "7",
                                                            "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                            false,
                                                            [781.69, -0.2153, -210.4],
                                                            false,
                                                        ],
                                                    ],
                                                        
                                                        
                                                    [
                                                        "Luftkühler für NK-Kälteanlagen",
                                                        [
                                                            "Leistung der Verdampfer:", 
                                                            " kW (Q̇₀ = 2,00 bis 110,00 kW)", 
                                                            "5",
                                                            "Geben Sie den Wärmestrom an, der den zu kühlenden Produkten entzogen wird, zuzüglich aller auftretenden Verluste. Die Dimensionierung der Verdampferleistung erfolgt nach dem Kältebedarf. Die Verdampferleistung muss innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                            [2, 110],
                                                            false,
                                                            false,
                                                        ],
                                                        [
                                                            "Kälteleistung:", 
                                                            " kW",
                                                            "7", 
                                                            "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                            false,
                                                            [233.2, -1, 61.1],
                                                            false,
                                                        ],
                                                    ],

                                                    [
                                                        "Luftkühler für AC- und Prozesskühlanlagen",  
                                                        [
                                                            "Leistung der Verdampfer:", 
                                                            " kW (Q̇₀ = 2,00 bis 110,00 kW)", 
                                                            "6", 
                                                            "Geben Sie den Wärmestrom an, der den zu kühlenden Produkten entzogen wird, zuzüglich aller auftretenden Verluste. Die Dimensionierung der Verdampferleistung erfolgt nach dem Kältebedarf. Die Verdampferleistung muss innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                            [2, 110],
                                                            false,
                                                            false, 
                                                        ],
                                                        [
                                                            "Kälteleistung:", 
                                                            " kW",
                                                            "7",
                                                            "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                            false,
                                                            [421.63, -1, 23.32],
                                                            "ruckkuehler",
                                                        ],
                                                    ],

                                                    [
                                                        "Adiabate Rückkühler (Hybridkühler)",  
                                                        [
                                                            "Leistung der Verflüssiger:", 
                                                            " kW (Q̇c = 100,00 bis 1.000,00 kW)",
                                                            "7",
                                                            false,
                                                            [100, 1000],
                                                            false,
                                                            false,
                                                        ],
                                                        [
                                                            "Kälteleistung:", 
                                                            " kW",
                                                            "7",
                                                            "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                            false,
                                                            [8239.4, -1.5944, 59.92],
                                                            "ruckkuehler",
                                                        ],
                                                    ],

                                                    [
                                                        "Rückkühler für flüssigkeitsgekühlte Anlagen", 
                                                        [
                                                            "Leistung der Verflüssiger:", 
                                                            " kW (Q̇c = 10,00 bis 500,00 kW)", 
                                                            "6",
                                                            false, 
                                                            [10, 500],
                                                            false,
                                                        ],
                                                        [
                                                            "Kälteleistung:", 
                                                            " kW",
                                                            "7",
                                                            "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                            false,
                                                            [26700.02, -3.4995, 21.21],
                                                            "ruckkuehler",
                                                        ],
                                                    ],

                                                    [
                                                        "Eigenständige Wärmepumpe mit nicht-halogeniertem Kältemittel zur Abwärmenutzung der Kälteanlage(n)",
                                                        [
                                                            "Leistung der Verdampfer:", 
                                                            " kW (Q̇₀ = 5,00 bis 500,00 kW)", 
                                                            "6",
                                                            "Geben Sie den Wärmestrom an, der den zu kühlenden Produkten entzogen wird, zuzüglich aller auftretenden Verluste. Die Dimensionierung der Verdampferleistung erfolgt nach dem Kältebedarf. Die Verdampferleistung muss innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                            [5, 500],
                                                            false,
                                                            false,
                                                        ],
                                                        [
                                                            "Kälteleistung:", 
                                                            " kW",
                                                            "7",
                                                            "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                            false,
                                                            [1246.73, -0.5614, -1.21],
                                                            false,
                                                        ],
                                                    ],

                                                    [
                                                        "Kühlmöbel für Supermarkt-Kälteanlagen (keine steckerfertigen Geräte) ",
                                                       [
                                                            "Länge der Kühlmöbel:", 
                                                            " lfdm", 
                                                            "7",
                                                            false,
                                                            [1, 100000],
                                                            [400],
                                                            false,
                                                        ],
                                                    ],

                                                    [

                                                        " Kühlsoleleitungen ",
                                                        [
                                                            "Länge der Rohrleitung:", 
                                                            " lfdm", 
                                                            "7",
                                                            false,
                                                            false,
                                                            false,
                                                            false,
                                                        ],
                                                        [
                                                            "Rohrdurchmesser:", 
                                                            " mm",
                                                            "7",
                                                            false,
                                                            false,
                                                            [0.5465, 7.6],
                                                            false,
                                                        ],

                                                    ],
                                                ],   

                                };



var TableThermischeSpeicher =  {    name:       "Thermische Speicher für Wärme und Kälte",
                                    hilfe:      "Geben Sie hier bitte die Leistung oder das Volumen der thermischen Speicher an, die gefördert werden sollen.",
                                    artikel:    [
                                                    [
                                                        "Warmwasser-Schichtenspeicher",
                                                        [   
                                                            "Volumen:", 
                                                            " dm³ (V = 400,00 bis 4.000,00 dm³)", 
                                                            "7",
                                                            false,
                                                            [400, 4000],
                                                            [520.64, -1.0034, 0.38],
                                                            false,
                                                        ],
                                                    ],
                                                        
                                                        
                                                    [
                                                        "Kaltwasserspeicher",  
                                                        [
                                                            "Volumen:", 
                                                            " dm³ (V = 500,00 bis 2.000,00 dm³)", 
                                                            "7",
                                                            false,
                                                            [500, 2000],
                                                            [10.9, -0.4512, 0.08],
                                                            false,
                                                        ],
                                                    ],

                                                    [
                                                        "Eisspeicher: Betongehäuse mit Wärmeübertrager",
                                                        [
                                                            "Kapazität:", 
                                                            " kWh (Q̇₀ = 150,00 bis 24.000,00 kWh)", 
                                                            "8",
                                                            false,
                                                            [150, 2400],
                                                            [4237.78, -1.0326, 2.26],
                                                            false,
                                                        ],
                                                    ],

                                                    [
                                                        "Latentwärmespeicher-Systeme: Behälter mit LWS (Kapsel)",  
                                                        [
                                                            "Kapazität:", 
                                                            " kWh (Q̇₀ = 60,00 bis 1.400,00 kWh)", 
                                                            "7",
                                                            false,
                                                            [60, 1400],
                                                            [6257.9, 1.4906, 21.34],
                                                            false,
                                                        ],
                                                    ],
                    
                                                ]
                                };





var BlockAnlage =               {   name: "Art der Anlage (Kälteerzeuger)",
                                    hilfe: "Geben Sie hier die Art des Kälteerzeugers an. Beachten Sie dabei bitte die Definitionen für verbundene Kälteerzeuger im Merkblatt Fachtechnik (siehe www.bafa.de) sowie die technischen Fördervoraussetzungen gemäß Ziffer 2.4.1 f der Förderrichtlinie.",
                                    text: "Bei der <strong> neuen Anlage </strong> handelt es sich um:",
                                    artikel:    [
                                                    [
                                                        "Flüssigkeitskühlsätze mit Kältemitteln der Sicherheitsklasse A3 (z.B. R-290, R-1270, R-600a)",
                                                        [
                                                            "Normalkühlung",
                                                            [
                                                                "Anlagen, flüssigkeitsgekühlt",
                                                                [
                                                                    "Leistungsaufnahme der Verdichter:",
                                                                    " kW (P = 2,00 bis 300,00 kW)",
                                                                    "6",
                                                                    "Geben Sie bitte die elektrische Leistungsaufnahme der Verdichter / Kältemaschine bzw. Verbundanlage an, die zur Abdeckung des Kältebedarfs benötigt wird. Bei Flüssigkeitskühlsätzenmuss dieser Wert innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                                    [2, 300],
                                                                    false,
                                                                    false,
                                                                ],

                                                                [
                                                                    "Kälteleistung:",
                                                                    " kW",
                                                                    "7",
                                                                    "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                                    false,
                                                                    [1394.48, -0.3892, -17.43],
                                                                    "kaelteerzeuger",
                                                                ],
                                                            ],


                                                            [
                                                                "Anlagen, luftgekühlt",
                                                                [
                                                                    "Leistungsaufnahme der Verdichter:",
                                                                    " kW (P = 2,00 bis 300,00 kW)",
                                                                    "6",
                                                                    "Geben Sie bitte die elektrische Leistungsaufnahme der Verdichter / Kältemaschine bzw. Verbundanlage an, die zur Abdeckung des Kältebedarfs benötigt wird. Bei Flüssigkeitskühlsätzenmuss dieser Wert innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                                    [2, 300],
                                                                    false,
                                                                    false,
                                                                ],

                                                                [
                                                                    "Kälteleistung:",
                                                                    " kW",
                                                                    "7",
                                                                    "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                                    false,
                                                                    [1104.97, 0.2564, 66.21],
                                                                    "kaelteerzeuger",
                                                                ],


                                                            ],

                                                            [
                                                                "Kombinierte Kompakt-Anlagen, flüssigkeitsgekühlt, mehrere Kältemittelkreisläufe,mit höchstens 80 g Kältemittel pro kW Kälteleistung",
                                                                [
                                                                    "Kälteleistung der Verdampfer:",
                                                                    " kW (Q̇₀ = 50,00 bis 300,00 kW)",
                                                                    "6",
                                                                    "Geben Sie den Wärmestrom an, der den zu kühlenden Produkten entzogen wird, zuzüglich aller auftretenden Verluste. Die Dimensionierung der Verdampferleistung erfolgt nach dem Kältebedarf. Die Verdampferleistung muss innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                                    [50, 300],
                                                                    false,
                                                                    false,
                                                                ],

                                                                [
                                                                    "Kälteleistung:",
                                                                    " kW",
                                                                    "7",
                                                                    "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                                    false,
                                                                    [32649.844, -3.1859, 192.49],
                                                                    "kaelteerzeuger",
                                                                ],


                                                            ],

                                                            [
                                                                "Kompakt-Anlagen, flüssigkeitsgekühlt, ein Kältemittelkreislauf, mit höchstens 80 g Kältemittel pro kW Kälteleistung",
                                                                [
                                                                    "Kälteleistung der Verdampfer:",
                                                                    " kW (Q̇₀ = 7,00 bis 45,00 kW)",
                                                                    "5",
                                                                    "Geben Sie den Wärmestrom an, der den zu kühlenden Produkten entzogen wird, zuzüglich aller auftretenden Verluste. Die Dimensionierung der Verdampferleistung erfolgt nach dem Kältebedarf. Die Verdampferleistung muss innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                                    [7, 45],
                                                                    false,
                                                                    false,
                                                                ],

                                                                [
                                                                    "Kälteleistung:",
                                                                    " kW",
                                                                    "7",
                                                                    "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                                    false,
                                                                    [2946.23, -0.7508, -26.39],
                                                                    "kaelteerzeuger",
                                                                ],
                                                            ],

                                                        ],

                                                        [
                                                            "Klima- und Prozesskälteanlagen",
                                                            [
                                                                "Anlagen, flüssigkeitsgekühlt",
                                                                [
                                                                    "Leistungsaufnahme der Verdichter:",
                                                                    " kW (P = 2,00 bis 300,00 kW)",
                                                                    "6",
                                                                    "Geben Sie bitte die elektrische Leistungsaufnahme der Verdichter / Kältemaschine bzw. Verbundanlage an, die zur Abdeckung des Kältebedarfs benötigt wird. Bei Flüssigkeitskühlsätzenmuss dieser Wert innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                                    [2, 300],
                                                                    false,
                                                                    false,
                                                                ],

                                                                [
                                                                    "Kälteleistung:",
                                                                    " kW",
                                                                    "7",
                                                                    "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                                    false,
                                                                    [1247.53, -0.3892, -14.53],
                                                                    "kaelteerzeuger",
                                                                ],
                                                            ],

                                                            [
                                                                "Anlagen, luftgekühlt",
                                                                [
                                                                    "Leistungsaufnahme der Verdichter:",
                                                                    " kW (P = 2,00 bis 300,00 kW)",
                                                                    "6",
                                                                    "Geben Sie bitte die elektrische Leistungsaufnahme der Verdichter / Kältemaschine bzw. Verbundanlage an, die zur Abdeckung des Kältebedarfs benötigt wird. Bei Flüssigkeitskühlsätzenmuss dieser Wert innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                                    [2, 300],
                                                                    false,
                                                                    false,
                                                                ],

                                                                [
                                                                    "Kälteleistung:",
                                                                    " kW",
                                                                    "7",
                                                                    "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                                    false,
                                                                    [1373.43, -0.4183, -13.04],
                                                                    "kaelteerzeuger",
                                                                ],

                                                            ],

                                                            [
                                                                "Kombinierte Kompakt-Anlagen, flüssigkeitsgekühlt, mehrere Kältemittelkreisläufe,mit höchstens 80 g Kältemittel pro kW Kälteleistung",
                                                                [
                                                                    "Kälteleistung der Verdampfer:",
                                                                    " kW (Q̇₀ = 90,00 bis 700,00 kW)",
                                                                    "6",
                                                                    "Geben Sie den Wärmestrom an, der den zu kühlenden Produkten entzogen wird, zuzüglich aller auftretenden Verluste. Die Dimensionierung der Verdampferleistung erfolgt nach dem Kältebedarf. Die Verdampferleistung muss innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                                    [90, 700],
                                                                    false,
                                                                    false,
                                                                ],

                                                                [
                                                                    "Kälteleistung:",
                                                                    " kW",
                                                                    "7",
                                                                    "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                                    false,
                                                                    [4896, -0.8842, 121.22],
                                                                    "kaelteerzeuger",
                                                                ],
                                                            ],

                                                            [
                                                                "Kompakt-Anlagen, flüssigkeitsgekühlt, ein Kältemittelkreislauf, mit höchstens 80 g Kältemittel pro kW Kälteleistung",
                                                                [
                                                                    "Kälteleistung der Verdampfer:",
                                                                    " kW (Q̇₀ = 15,00 bis 100,00 kW)",
                                                                    "5",
                                                                    "Geben Sie den Wärmestrom an, der den zu kühlenden Produkten entzogen wird, zuzüglich aller auftretenden Verluste. Die Dimensionierung der Verdampferleistung erfolgt nach dem Kältebedarf. Die Verdampferleistung muss innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                                    [15, 100],
                                                                    false,
                                                                    false,
                                                                ],

                                                                [
                                                                    "Kälteleistung:",
                                                                    " kW",
                                                                    "7",
                                                                    "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                                    false,
                                                                    [2786.02, -0.7437, -24.94],
                                                                    "kaelteerzeuger",
                                                                ],
                                                            ],
                                                        ],
                                                    ],

                                                    [
                                                        "Sonstige stationäre Kälteerzeuger ",
                                                        [   
                                                            "Ab- und Adsorptionsanlagen",
                                                            [
                                                                "Kälteleistung der Verdampfer:",
                                                                " kW (Q̇₀ = 5,00 bis 600,00 kW)",
                                                                "6",
                                                                "Geben Sie den Wärmestrom an, der den zu kühlenden Produkten entzogen wird, zuzüglich aller auftretenden Verluste. Die Dimensionierung der Verdampferleistung erfolgt nach dem Kältebedarf. Die Verdampferleistung muss innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                                [5, 600],
                                                                false,
                                                                false,
                                                            ],

                                                            [
                                                                "Kälteleistung:",
                                                                " kW",
                                                                "7",
                                                                "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                                false,
                                                                [1484.38, -0.2682, -74.31],
                                                                "kaelteerzeuger",
                                                            ],
                                                        ],

                                                        [
                                                            "Adiabate Verdunstungskühlanlagen",
                                                            [
                                                                "Kälteleistung der Verdampfer:",
                                                                " kW (Q̇₀ = 10,00 bis 240,00 kW)",
                                                                "6",
                                                                "Geben Sie den Wärmestrom an, der den zu kühlenden Produkten entzogen wird, zuzüglich aller auftretenden Verluste. Die Dimensionierung der Verdampferleistung erfolgt nach dem Kältebedarf. Die Verdampferleistung muss innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                                [10, 240],
                                                                false,
                                                                false,
                                                            ],

                                                            [
                                                                "Kälteleistung:",
                                                                " kW",
                                                                "7",
                                                                "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                                false,
                                                                [3567.45, -1.0788, 70.79],
                                                                "kaelteerzeuger",
                                                            ],
                                                        ],

                                
                                                        [
                                                            "Booster-Gewerbekälteanlagen mit R-744",
                                                            [
                                                                "Kälteleistung der Verdampfer:",
                                                                " kW (Q̇₀ = 30,00 bis 400,00 kW)",
                                                                "6",
                                                                "Geben Sie den Wärmestrom an, der den zu kühlenden Produkten entzogen wird, zuzüglich aller auftretenden Verluste. Die Dimensionierung der Verdampferleistung erfolgt nach dem Kältebedarf. Die Verdampferleistung muss innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                                [30, 400],
                                                                false,
                                                                false,
                                                            ],

                                                            [
                                                                "Kälteleistung:",
                                                                " kW",
                                                                "7",
                                                                "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                                false,
                                                                [1192.97, -0.427, 58.61],
                                                                "kaelteerzeuger",
                                                            ],
                                                        ],

                                                        [
                                                            "Booster-Supermarktanlagen mit R-744",
                                                            [
                                                                "Kälteleistung der Verdampfer:",
                                                                " kW (Q̇₀ = 30,00 bis 400,00 kW)",
                                                                "6",
                                                                "Geben Sie den Wärmestrom an, der den zu kühlenden Produkten entzogen wird, zuzüglich aller auftretenden Verluste. Die Dimensionierung der Verdampferleistung erfolgt nach dem Kältebedarf. Die Verdampferleistung muss innerhalb der hinter dem Eingabefeld ausgewiesenen Leistungsgrenzen liegen.",
                                                                [30, 400],
                                                                false,
                                                                false,
                                                            ],

                                                            [
                                                                "Kälteleistung:",
                                                                " kW",
                                                                "7",
                                                                "Geben Sie bitte die zu Installierende Kälteleistung der Kältemaschine bzw. Verbundanlage (Kälteerzeuger) an, die zur Abdeckung des Kältebedarfs benötigt wird. Die Kälteleistung ist außer bei Booster Supermarktkälteanlagenmit R-744 maßgeblich für die Berechnung des Förderbetrags für den/die Kälteerzeuger. Beachten Sie die Hinweise zur Berechnung der Kälteleistung im Merkblatt Fachtechnik auf www.bafa.de.",
                                                                false,
                                                                [1192.79, -0.4270, 58.61],
                                                                "kaelteerzeuger",
                                                            ],
                                                        ],
                                                    ],
                                                ],
}



    // create_blocks.js
function create_block () {
    let blocks = document.formcalcbafa.getElementsByTagName('fieldset');
    let num_blocks = blocks.length
    for (let i = 0; i < num_blocks; i++) {
        if (!blocks[i].className) {     // Klasse noch nicht definiert
            init_block (blocks[i]);
        }         
    }
}



// Block erstellen
function init_block (block) {                            
    let Block = this[block.id];                             // Blockid auf Objekt referenzieren

    let block_dom = document.getElementById(block.id);     // Verbingung zum HTML-Element
    block_dom.className = "fieldblock";

    // Beschriftung
    let label_block = document.createElement('legend');

    if (Block.hilfe) { // Ist Hilfetext vorhanden Tooltipp erstellen
         init_help (label_block, block.id, Block.hilfe);
    }

    text = document.createTextNode(Block.name);
    label_block.appendChild(text);
    block_dom.appendChild(label_block);

    let block_text = document.createElement('div');
    block_text.className = "haupttext";

    let main_text = document.createElement('main');
    main_text.innerHTML = Block.text;
    block_text.appendChild(main_text);
   

    let option; let label_option; let span;
    for (let i = 0; i < Block.artikel.length; i++) {

        label_option = document.createElement('label');
        label_option.innerHTML = Block.artikel[i][0];
        label_option.className = "containerCheck";

        option = document.createElement('input');
        option.type = "radio";
        option.name = "block_radio";
        option.className = "inputCheck";
        option.id = block.id +"select1";
        option.value = i + 1;
        option.onclick = function() {lev2_block(block.id, Block.artikel[i], 1) };
        label_option.appendChild(option);

        span = document.createElement('span');
        span.className = 'checkmark';
        label_option.appendChild(span);


        block_text.appendChild(label_option);
    ;}

    block_dom.appendChild(block_text);

};


// Zwischenblock(s) einfuegen
function lev2_block (blockid, place, firstrun) {
    if (firstrun) {
        var num3 = 2;
    } else {
        var num3 = 3;
    }
    let block_text = document.createElement('div');
    block_text.className = 'haupttext';
    let next_lev = Array.isArray(place[1][1][1]);
    let option; let label_option; let span;
    for (let i = 1; i < place.length; i++) {

        label_option = document.createElement('label');
        label_option.innerHTML = place[i][0];
        label_option.className = "containerCheck";

        option = document.createElement('input');
        option.type = 'radio';
        option.name = 'block_radio' + num3;
        option.className = 'inputCheck';
        option.id = blockid + 'select' + num3;
        option.value = i + 1;
        if (!next_lev) option.onclick = function() { lev3_block(blockid, place[i], num3 + 1)};
        else option.onclick = function() { lev2_block(blockid, place[i]) };
        label_option.appendChild(option);

        span = document.createElement('span');
        span.className = 'checkmark';
        label_option.appendChild(span);


        block_text.appendChild(label_option);
    };
    block_text.insertBefore(document.createElement('hr'), block_text.firstChild);
    add_block (blockid, block_text, num3);
};


// Abschlussblock
function lev3_block (blockid, place, max) { 
    let block_text = document.createElement('div');
    block_text.className = 'haupttext';
    inseret_fields (block_text, place, blockid);
    block_text.insertBefore(document.createElement('hr'), block_text.firstChild);
    add_block (blockid, block_text, max);
}


// Neu erstellen Block einfuegen und alte Blocks gegebenfalls loeschen
function add_block (blockid, new_block, max) {
    let block_dom = document.getElementById(blockid);
    if (document.getElementsByName('kaelteerzeuger')[0]) {
        let output = 0;
        let outputfield = document.getElementsByName('kaelteerzeuger')[0].nextElementSibling.nextElementSibling;
        let oldvalue = outputfield.dataset.out;
        if (!oldvalue) oldvalue = 0;
        let err = false;
        set_output(output, oldvalue, outputfield, err); 
    };
    let blocks = block_dom.getElementsByTagName('div').length;
    if (blocks > max) {
        for (let s = max; s < blocks; s++) {
            block_dom.removeChild(block_dom.lastChild);
        };
    };
    if (blocks >= max) {
        //debugger;
        let replace = block_dom.lastChild;
        block_dom.replaceChild(new_block, replace);
    } else block_dom.appendChild(new_block);
};

    // create_tables.js
// Prüfen ob eine Tabelle im html-code bereits angelegt ist
function create_tables () {
    let tables = document.formcalcbafa.getElementsByTagName('table');
    let num_tables = tables.length
    for (let i = 0; i < num_tables; i++) {
        if (!tables[i].className) {     // Klasse noch nicht definiert
            init_table (tables[i]);
        }         
    }
}

// Tabelle erstellen
function init_table (table) {                            
    let Table = this[table.id];                             // Tabellenid auf Objekt referenzieren


    // Tabellenfuß erstellen
    let div = document.createElement('div');
    div.className = 'custom-select';

    let select = document.createElement('select');         // Tabellenfuß erstellen
    select.id = 'select' + table.id;
    select.setAttribute('onchange', 'if (this.selectedIndex) add_row(this.parentNode);');

    let option = document.createElement('option');
    option.value = '';
    option.appendChild(document.createTextNode('--- ' +and_or(Table.name)+ ' hinzufügen ---'));
    select.appendChild(option);
    for (let i = 0; i < Table.artikel.length; i++) {
        option = document.createElement('option');
        option.value = cleartext(Table.artikel[i][0]);
        option.appendChild(document.createTextNode(Table.artikel[i][0]));
        select.appendChild(option);
    }

    let td = document.createElement('td');
    td.setAttribute('colspan', 3);

    div.appendChild(select);
    td.appendChild(div);

    let tr = document.createElement('tr');
    tr.appendChild(td);

    let food = document.createElement('tfoot');         // Tabellenfuß erstellen
    food.appendChild(tr);

    let table_dom = document.getElementById(table.id);     // Verbingung zum HTML-Element
    table_dom.style.display = 'table';
    table_dom.className = 'tableAnlage';
    table_dom.appendChild(food);


    // colgruop ersten
    let colg = document.createElement('colgroup');

    let col1 = document.createElement('col');
    col1.width = '5%';
    colg.appendChild(col1);
    let col2 = document.createElement('col');
    col2.width = '85%';
    colg.appendChild(col2);
    let col3 = document.createElement('col');
    col3.width = '10%';
    colg.appendChild(col3);

    table_dom.appendChild(colg);


    // Tabellenkopf erstellen
    let trhead = document.createElement('tr');
    
    let th1 = document.createElement('th');



    let textnr1 = document.createTextNode ('Nr.');
    th1.appendChild(textnr1);
    trhead.appendChild(th1);

    th2 = document.createElement('th');
    

    if (Table.hilfe) { // Ist Hilfetext vorhanden Tooltipp erstellen
        init_help (th2, table.id, Table.hilfe);
    }

    let textnr2 = document.createTextNode (Table.name);
    th2.appendChild(textnr2);
    trhead.appendChild(th2);

    let th3 = document.createElement('th');
    trhead.appendChild(th3);

    let head = document.createElement('thead');
    head.appendChild(trhead);
    head.style.display = 'none';

    table_dom.appendChild(head);

    // Tabelle in eigen fieldset einbetten
    let fieldtable = document.createElement('fieldset');
    fieldtable.className = 'fieldtableAnlage';

    
    tableBody = document.createElement('tbody');
    table_dom.appendChild(tableBody);
    




    let newplace = table_dom.parentNode;
    let clone = table_dom.cloneNode(true);
    fieldtable.appendChild(clone);
    newplace.replaceChild(fieldtable, table_dom);

    // Optionen einfuegen
    if (Table.option) {

        // Beschreibung
        let divdes = document.createElement('div');
        let text = document.createTextNode(Table.option[0]);
        divdes.appendChild(text);

        fieldtable.appendChild(divdes);

        // Abhackfeld einfuegen

        let label = document.createElement('label');
        text = document.createTextNode(Table.option[1] + " " + Table.option[2]);
        label.appendChild(text);
        label.className = "containerBox";

        let inputcheck = document.createElement('input');
        //inputcheck.className = "inputcheck";
        inputcheck.type = "checkbox";
        inputcheck.name = cleartext(Table.option[0]);
        //inputcheck.value = true;
        inputcheck.onchange = function checkbox_checked () {
            if (this.checked) {
                create_outputfields (this, Table.option[3]);
                calc_option ();
            } else {
                let outputfield = document.getElementById('freikuehlout');
                let oldvalue = Number(outputfield.dataset.out);
                set_output(0, oldvalue, outputfield, false);
                this.parentNode.removeChild(this.parentNode.lastChild);
            }
        };
        label.appendChild(inputcheck);

        span = document.createElement('span');
        span.className = 'checkbox';
        label.appendChild(span);
        

        //let divcheck = document.createElement('div');

        fieldtable.appendChild(label);



    }
    
}

function create_outputfields (element, text) {

    let div = document.createElement('div');

    // Beschreibung hinten 
    inOut = document.createElement('output');           // Ausgabefeld erstellen
    text = document.createTextNode(text);               // Beschreibung einfuegen
    inOut.appendChild(text);
    //inOut.style.color = 'green';
    div.appendChild(inOut);                             // Ausgabe in Beschreibungstext einfuegen
    
    // Ausgabe
    inOutput = document.createElement('output');        // Ausgabefeld erstellen
    inOutput.className = 'ausgabe';
    inOutput.style.color = 'green';
    inOutput.id = 'freikuehlout';
    div.appendChild(inOutput);                       // Ausgabe in Beschreibungstext einfuegen
    element.parentNode.appendChild(div);
}


// Tabellen Spalten nummerieren
function num_table_rows(tableRows) {
    for(let i = 0; i < tableRows.length; i++) {
        tableRows[i].getElementsByTagName('td')[0].innerHTML = (i+1);
    }
}


// Spalte loeschen
function remove_row(startpoint) {
    let tr = startpoint.parentNode.parentNode
    let tbody = tr.parentNode;

    // Evtl. eingegebene Werte loeschen
    let output = 0;
    let outputfield = startpoint.parentNode.previousElementSibling.lastChild.lastChild;
    let oldvalue = outputfield.dataset.out;
    if (!oldvalue) oldvalue = 0;
    let err = false;
    set_output(output, oldvalue, outputfield, err);

    /*$(tr).animate({  // Animieren und loeschen der Zeile
        padding: '0px',
        marginRight:'-10px',
        fontSize: '0px',
        opacity: 0.4,
      }, 250, function() {
          $(tr).remove();      
      });
    */
    tbody.removeChild(tr);
    

    let rows = tbody.getElementsByTagName('tr');
    num_table_rows(rows);  // Nummerierung erneuern
    if (!rows.length) {
        let table = tbody.parentNode;
        let thead = table.getElementsByTagName('thead')[0];
        thead.style.display = 'none';
        table.appendChild(thead);       // Tabellenkopf ausblenden wenn keine Zeilen mehr da sind
    }
}

// Spalte hinzufuegen
function add_row(entry) {
    //debugger;
    let table_dom_Add = entry.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;
    let TableAdd = this[table_dom_Add.id];

    // entfällt wegen Umstellung auf Listengenerierung durch Javascript
    //let table_dom_Add = entry.parentNode.parentNode.parentNode.parentNode;
    //let astS= document.getElementById('select' + table_dom_Add.id); // Auswahlliste suchen
    //let SelIn = astS.options[astS.selectedIndex].text;              // Text der ausgewaehlten Zeile speichern
    //let SelInV = astS.options[astS.selectedIndex].value;            // Wert der ausgewaehlten Zeile speichern

    // Aus der Javascript Funktion create_lists
    let SelIn = entry.innerHTML;
    let SelInV = entry.dataset.value;


    let tableBody = table_dom_Add.getElementsByTagName('tbody')[0];


    // Nummerierung der Zeilen
    let row_num = tableBody.getElementsByTagName('tr').length;
    if (row_num) {                                      
        num_table_rows(tableBody.getElementsByTagName("tr"));
    } else {
        table_dom_Add.getElementsByTagName('thead')[0].style.display = 'table-header-group'; // Tabellenkopf sichtbar machen
    }
    row_num ++;


    // Eintrag erstellen
    let newRow = document.createElement('tr'); // Neuer Tabelleneintrag erstellen


    let colNum = document.createElement('td'); // Spalte fuer Nummerierung erstellen

    let text = document.createTextNode(row_num);
    colNum.appendChild(text);
    let colNumIn = document.createElement('input');
    colNumIn.type = 'hidden';
    colNumIn.id = table_dom_Add.id;
    colNumIn.value = row_num;
    colNum.appendChild(colNumIn); // Identifizerung der Nummernsplate einfuegen
    newRow.appendChild(colNum); // Nummerspalte in Tabelleneintrag einfuegen



    let colIn = document.createElement('td'); // Spalte fuer Input erstellen


    let newMain = document.createElement('div'); // Textfeld fuer Hauptext erstellen
    newMain.className = 'haupttext';
    let MainOut = document.createElement('output'); // Ausgabe fuer Hauptext erstellen
    text = document.createTextNode(SelIn);
    MainOut.appendChild(text);          // Text in Ausgabe einfuegem   
    newMain.appendChild(MainOut);       // Ausgabe in Haupttext einfuegen
    colIn.appendChild(newMain);         // Haupttext in Inputspalte einfuegen
    
    
    for (let a = 0; a< TableAdd.artikel.length; a++) {  // Schleife je Artikel

        if (SelInV == cleartext(TableAdd.artikel[a][0])) {
        let getitfrom = TableAdd.artikel[a];
        inseret_fields (colIn, getitfrom, table_dom_Add.id);
        newRow.appendChild(colIn);                      // Inputspalte in Tabelleneintrag einfeugen
        }
    }
        

    let colDel = document.createElement('td'); // Spalte fuer Loeschfunktion erstellen

    
    let newButton = document.createElement('input');  // Neuer Button "loeschen"
    newButton.type = 'Button';
    newButton.value = 'entfernen';
    newButton.className = 'clearbutton';
    newButton.setAttribute('onClick', 'remove_row(this);' ); // Loeschfunktion
    colDel.appendChild(newButton);  // Neuer Button hinten anhaengen
    
    newRow.appendChild(colDel);          // Loeschpalte in Tabelleneintrag einfeugen
    tableBody.appendChild(newRow);      // Tabelleneintrag in tbody einfeugen

    entry.selectedIndex = 0;            // Auswahlliste auf ersten Eintrag setzen
}


// Felder einfuegen
function inseret_fields (inseretin, getitfrom, id_from) {
    // Variablen Initialisieren
    let textunit; let textdes; let maxlength; let helptext; let newDes; let desOut; let text; let newIn; let inIn; let inOut; let minmax; let calc;
    let fields = getitfrom.length;

    for (let p = 1; p < fields; p++) {        // Schleife je Feld

        textunit = getitfrom[p][0];
        textdes = getitfrom[p][1];
        maxlength = getitfrom[p][2];
        helptext = getitfrom[p][3];
        minmax = getitfrom[p][4];
        calc = getitfrom[p][5];
        fieldname = getitfrom[p][6];

        // Beschreibung vorne
        newDes = document.createElement('p');         // Textfeld fuer Beschreibung erstellen
        newDes.className = 'label';
        desOut = document.createElement('output');      // Ausgabefeld erstellen

        if (helptext) { // Ist Hilfetext vorhanden Tooltipp erstellen
            init_help (desOut, id_from, helptext);
        }

        text = document.createTextNode(textunit);
        desOut.appendChild(text);                       // Text in Ausgabe einfuegen
        newDes.appendChild(desOut);                     // Ausgabe in Beschreibungstext einfuegen

        inseretin.appendChild(newDes);                      // Beschreibungstext in Inputspalte


        // Eingabe
        newIn = document.createElement('p');          // Textfeld fuer Eingabe erstellen
        newIn.className = "feld";
        inIn = document.createElement('input');         // Eingabefeld erstellen
        inIn.maxlength = maxlength;
        inIn.className = "inputKlein numericOnly";
        inIn.type = 'text';
        inIn.name = fieldname;
        inIn.setAttribute('onInput', 'calc(this); calc_option()');
        inIn.dataset.minmax = minmax;
        inIn.dataset.calc = calc;
        newIn.appendChild(inIn);                        // Neues Eingabefeld anhaengen


        // Beschreibung hinten
        inOut = document.createElement('output');        // Ausgabefeld erstellen
        text = document.createTextNode(textdes);
        inOut.appendChild(text);                        // Text in Ausgabe einfuegem
        newIn.appendChild(inOut);                       // Ausgabe in Beschreibungstext einfuegen

        // Ausgabe
        inOutput = document.createElement('output');        // Ausgabefeld erstellen
        inOutput.className = "ausgabe";
        newIn.appendChild(inOutput);                       // Ausgabe in Beschreibungstext einfuegen

        inseretin.appendChild(newIn);                   // Eingabefeld in Inputspalte einfuegen
    }
}

function create_lists () {
    // Auswahlliste
    var x, i, j, selElmnt, a, b, c;
    /* Look for any elements with the class "custom-select": */
    x = document.getElementsByClassName("custom-select");
    for (i = 0; i < x.length; i++) {
    selElmnt = x[i].getElementsByTagName("select")[0];

    /* For each element, create a new DIV that will act as the selected item: */
    a = document.createElement("DIV");
    a.setAttribute("class", "select-selected");
    a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
    //a.dataset.value = selElmnt.options[selElmnt.selectedIndex].value;
    x[i].appendChild(a);
    /* For each element, create a new DIV that will contain the option list: */
    b = document.createElement("DIV");
    b.setAttribute("class", "select-items select-hide");
    for (j = 1; j < selElmnt.length; j++) {
        /* For each option in the original select element,
        create a new DIV that will act as an option item: */
        c = document.createElement("DIV");
        c.innerHTML = selElmnt.options[j].innerHTML;
        c.dataset.value = selElmnt.options[j].value;
        c.addEventListener("click", function(e) {
            /* When an item is clicked, update the original select box,
            and the selected item: */
            var y, i, k, s, h;
            s = this.parentNode.parentNode.getElementsByTagName("select")[0];
            h = this.parentNode.previousSibling;
            for (i = 0; i < s.length; i++) {
                if (s.options[i].innerHTML == this.innerHTML) {
                    s.selectedIndex = i;
                    h.innerHTML = this.innerHTML;
                    //h.dataset.value = this.value;
                    y = this.parentNode.getElementsByClassName("same-as-selected");
                    for (k = 0; k < y.length; k++) {
                        y[k].removeAttribute("class");
                    }
                    this.setAttribute("class", "same-as-selected");
                    add_row(this);
                    break;
                }
            }
            h.click();
        });
        b.appendChild(c);
    }
    x[i].appendChild(b);
    a.addEventListener("click", function(e) {
        /* When the select box is clicked, close any other select boxes,
        and open/close the current select box: */
        e.stopPropagation();
        closeAllSelect(this);
        this.nextSibling.classList.toggle("select-hide");
        this.classList.toggle("select-arrow-active");
    });
    }

    function closeAllSelect(elmnt) {
    /* A function that will close all select boxes in the document,
    except the current select box: */
    var x, y, i, arrNo = [];
    x = document.getElementsByClassName("select-items");
    y = document.getElementsByClassName("select-selected");
    for (i = 0; i < y.length; i++) {
        if (elmnt == y[i]) {
        arrNo.push(i)
        } else {
        y[i].classList.remove("select-arrow-active");
        }
    }
    for (i = 0; i < x.length; i++) {
        if (arrNo.indexOf(i)) {
        x[i].classList.add("select-hide");
        }
    }
    }

    /* If the user clicks anywhere outside the select box,
    then close all select boxes: */
    document.addEventListener("click", closeAllSelect);
}

    //create_checkfields.js
function create_checkfields () {        // Auswahlfelder erstellen
    document.getElementById('plan_check').onchange = function checkbox_checked () {
        let dom = document.getElementById('plan_check').parentNode.parentNode.parentNode;
        if (document.getElementById('plan_check').checked) {
            let div = document.createElement('div');
            div.className = 'label';
            let label = document.createElement ('label');
            init_help (label, 'plan_check', '500,00 EUR pro Lüfter, Minimum 1.000,00 EUR - Maximal 5.000,00 EUR');
            let text = document.createTextNode('Anzahl der Lüfter:');
            

            label.appendChild(text);
            div.appendChild(label);
            dom.appendChild(div);


            div = document.createElement('div'); // Leufter
            div.className = 'feld';

            let input = document.createElement('input');
            input.className = 'inputKlein numericOnly';
            input.maxLength = 2;
            input.type = 'text';
            input.name = 'textfeldname[]';
            input.id = 'AnzahlLuefter';
            input.dataset.minmax = '1000, 5000';
            input.dataset.calc = 500;
            input.setAttribute('onInput', 'calcluefter(this)');

            div.appendChild(input);


            // Beschreibung hinten (Warunung)
            inOut = document.createElement('output');           // Ausgabefeld erstellen
            inOut.style.color = 'orange';
            div.appendChild(inOut);                             // Ausgabe in Beschreibungstext einfuegen

            // Ausgabe
            inOutput = document.createElement('output');        // Ausgabefeld erstellen
            inOutput.className = 'ausgabe';
            div.appendChild(inOutput);                       // Ausgabe in Beschreibungstext einfuegen

            dom.appendChild(div);


            div = document.createElement('div'); // Waermespeicher
            div.className = 'haupttext';

            label = document.createElement ('label');
            text = document.createTextNode('Mindestens ein Wärmespeicher wird integriert.');
            label.appendChild(text);
            label.className = "containerBox";

            input = document.createElement('input');
            input.className = 'inputcheck';
            input.type = 'checkbox';
            input.value = 'true';
            input.id = 'Waermespeicher';
            input.onchange = function checkbox_checked () {
                if (this.checked) set_output (1000, 0, this.nextElementSibling.nextElementSibling.nextElementSibling, 0);
                else set_output (0, 1000, this.nextElementSibling.nextElementSibling.nextElementSibling, 0);
            };
            label.appendChild(input);

            span = document.createElement('span');
            span.className = 'checkbox';
            label.appendChild(span);
    
            


            // Beschreibung hinten (Warunung)
            inOut = document.createElement('output');           // Ausgabefeld erstellen
            inOut.style.color = 'orange';
            label.appendChild(inOut);                             // Ausgabe in Beschreibungstext einfuegen
            
            // Ausgabe
            inOutput = document.createElement('output');        // Ausgabefeld erstellen
            inOutput.className = 'ausgabe';
            inOutput.style.color = 'green';
            label.appendChild(inOutput);                       // Ausgabe in Beschreibungstext einfuegen

            div.appendChild(label);

            dom.appendChild(div);


            div = document.createElement('div'); // Kaeltespeicher
            div.className = 'haupttext';

            label = document.createElement ('label');
            text = document.createTextNode('Mindestens ein Kältespeicher wird integriert.');
            label.appendChild(text);
            label.className = "containerBox";

            input = document.createElement('input');
            input.className = 'inputcheck';
            input.type = 'checkbox';
            input.value = 'true';
            input.id = 'Kaeltespeicher';
            input.onchange = function checkbox_checked () {
                if (this.checked) set_output (1000, 0, this.nextElementSibling.nextElementSibling.nextElementSibling, 0);
                else set_output (0, 1000, this.nextElementSibling.nextElementSibling.nextElementSibling, 0);
            };

            label.appendChild(input);

            span = document.createElement('span');
            span.className = 'checkbox';
            label.appendChild(span);

            // Beschreibung hinten (Warunung)
            inOut = document.createElement('output');           // Ausgabefeld erstellen
            inOut.style.color = 'orange';
            label.appendChild(inOut);                             // Ausgabe in Beschreibungstext einfuegen
            
            // Ausgabe
            inOutput = document.createElement('output');        // Ausgabefeld erstellen
            inOutput.className = 'ausgabe';
            inOutput.style.color = 'green';
            label.appendChild(inOutput);  
            
            div.appendChild(label);

            dom.appendChild(div);
            
            
        } else {
            // Beim "Hacken rausnehmen" das zuvor erstellt loeschen
            dom.removeChild(dom.lastChild);
            dom.removeChild(dom.lastChild);
            dom.removeChild(dom.lastChild);
            dom.removeChild(dom.lastChild);
        }
    };
};

    // Foerderrechner.js
// und in oder umwandeln
function and_or (text) {
    return text.replace(/und/, 'oder');
}


// Sonderzeichen loeschen
function cleartext (value) {
    value = value.replace(/\u00e4/g, 'ae');
    value = value.replace(/\u00c4/g, 'AE');
    value = value.replace(/\u00d4/g, 'oe');
    value = value.replace(/\u00e4/g, 'OE');
    value = value.replace(/\u00f6/g, 'ue');
    value = value.replace(/\u00d6/g, 'UE');
    value = value.replace(/\u00df/g, 'ss');
    value = value.replace(/ /g, '-');
    value = value.replace(/\./g, '');
    value = value.replace(/\,/g, '');
    value = value.replace(/\(/g, '');
    value = value.toLocaleUpperCase();
    return value;
}


function create_tooltip (id) {
    let tooltip = document.getElementById(id);
    tooltip.classList.toggle("show");
}


// Hilfetext in HTML einfuegen
function init_help (block, id_from, helptext) {
    block.className = 'tooltipbafa';
    let id = Math.floor(Math.random() * 1000000000); 
    block.setAttribute('onClick', 'create_tooltip(\'' + id_from + id + '\');');
    let helpspan = document.createElement('span');
    helpspan.className = 'tooltiptext';
    helpspan.id = id_from + id;
    text = document.createTextNode(helptext);
    helpspan.appendChild(text);
    block.appendChild(helpspan);
}


function calcluefter (element) {
    let newInput = parseInt(element.value);
    let minmax = element.dataset.minmax === 'false' ? false : JSON.parse("["+ element.dataset.minmax + "]");
    let calc = element.dataset.calc === 'false' ? false : JSON.parse("["+ element.dataset.calc + "]");
    let outputfield = element.nextElementSibling.nextElementSibling;
    let oldvalue = outputfield.dataset.out ? Number(outputfield.dataset.out) : 0;
    let output = '';
    let err = false;
    //debugger;
    if (newInput) {
        outputfield.style.color = 'green';
        output = newInput * calc;
        element.nextElementSibling.value = ''; // Evtl. vorher ausgegeben Warnung loeschen
        if (output < minmax[0]) {
            output = minmax[0];
        } else if (output > minmax[1]) {
            output = minmax[1];
            element.nextElementSibling.value = ' Maximal ' + euro(minmax[1]) + ' Förderung';
        }

    }

    set_output (output, oldvalue, outputfield, err);
}


function calc (element) {
    let newInput = parseInt(element.value);
    let minmax = element.dataset.minmax === 'false' ? false : JSON.parse("["+ element.dataset.minmax + "]");
    let calc = element.dataset.calc === 'false' ? false : JSON.parse("["+ element.dataset.calc + "]");
    let outputfield = element.nextElementSibling.nextElementSibling;
    let oldvalue = outputfield.dataset.out ? Number(outputfield.dataset.out) : 0;
    let output = '';
    let err = false;
    if (calc && newInput || !calc && !minmax) {
        outputfield.style.color = 'green';
        if (calc.length == 3) {         // Förderung für stationäre Anlagen          
            output = (calc[0]*Math.pow(newInput, calc[1])+calc[2])*newInput;
        }
        else if (calc.length == 2 || !calc && !minmax) {    // Förderung Kühlsolekreisläufe
            
            let length ;
            let diameter;
            if (element.nextElementSibling.value == " lfdm") { // erstes Feld
                length = newInput;
                diameter = element.parentNode.nextElementSibling.nextElementSibling.firstChild.value;
                if (!diameter) diameter = 0;
                calc = JSON.parse("["+ element.parentNode.nextElementSibling.nextElementSibling.firstChild.dataset.calc + "]");
                // Ausgabefeld umschreiben
                outputfield = element.parentNode.nextElementSibling.nextElementSibling.firstChild.nextElementSibling.nextElementSibling;
                oldvalue = outputfield.dataset.out ? Number(outputfield.dataset.out) : 0;

                if (!length) {
                    element.nextElementSibling.nextElementSibling.style.color = 'red';
                    element.nextElementSibling.nextElementSibling.value = "Bitte länge angeben";
                } else element.nextElementSibling.nextElementSibling.value = '';
                if (!diameter) {
                    err = 2;
                    element.parentNode.nextElementSibling.nextElementSibling.firstChild.nextElementSibling.nextElementSibling.style.color = 'red';
                    element.parentNode.nextElementSibling.nextElementSibling.firstChild.nextElementSibling.nextElementSibling.value = "Bitte Durchmesser angeben";
                }
                
            } else { // zweites Feld
                diameter = newInput;
                length = element.parentNode.previousElementSibling.previousElementSibling.firstChild.value;

                if (!length) {
                    length = 0;
    
                    element.parentNode.previousElementSibling.previousElementSibling.firstChild.nextElementSibling.nextElementSibling.color = 'red';
                    element.parentNode.previousElementSibling.previousElementSibling.firstChild.nextElementSibling.nextElementSibling.value = "Bitte länge angeben";
                } else element.parentNode.previousElementSibling.previousElementSibling.firstChild.nextElementSibling.nextElementSibling.value = '';

                if (!diameter) {
                    err = 2;
                    element.nextElementSibling.nextElementSibling.style.color = 'red';
                    element.nextElementSibling.nextElementSibling.value = "Bitte Durchmesser angeben";
                }

            }
            if (length && diameter) { // Nur berechnen wenn beide Angaben vorhanden
                output = calc[0]*length*diameter+calc[1];
            }

        } else {                        // Kühlmöbel
            output = newInput * calc[0];
        };
    };


    if (minmax) {
        if (newInput < minmax[0]) {
            outputfield.style.color = 'red';
            err = true;
            output = "Achtung: Förderung erst ab " + minmax[0] + element.nextElementSibling.value;
        } else if (newInput > minmax[1]) {
            err = true;
            outputfield.style.color = 'red';
            output = "Achtung: Förderung bis maximal " + minmax[1] + element.nextElementSibling.value;
        }
    };

    set_output (output, oldvalue, outputfield, err);
}


function set_output(output, oldvalue, outputfield, err) {   // Ausgabe
    //debugger;
    let oldvaluetotal = document.getElementById('total').dataset.out ? Number(document.getElementById('total').dataset.out) : 0;
    if (!err) { // keine Fehler
        if (output) {
            outputformat = euro(output);
        } else outputformat = '';
        outputfield.value = outputformat;
        outputfield.dataset.out = output;
        // Gesamtergebnis 
        let newtotal = oldvaluetotal - oldvalue + output;
        
        if (newtotal) {
            if (newtotal > 150000) {
                var newtotalout = 150000;
                document.getElementById('total').nextElementSibling.value = 'Maximale Fördersumme 150.000,00 EUR';
            } else {
                var newtotalout = newtotal;
                document.getElementById('total').nextElementSibling.value = '';
            };
            document.getElementById('total').value ="Fördersumme: " + euro(newtotalout);
            document.getElementById('total').dataset.out = newtotal;
        } else {
            document.getElementById('total').value = '';
            document.getElementById('total').dataset.out = 0;
        };
   
    } else if (err !== 2) {
        outputfield.value = output;
        if (oldvalue) {
            let newtotal = oldvaluetotal - oldvalue;
            outputfield.dataset.out = 0;
            if (newtotal) {
                if (newtotal > 150000) {
                    var newtotalout = 150000;
                    document.getElementById('total').nextElementSibling.value = 'Maximale Fördersumme 150.000,00 EUR';
                } else {
                    var newtotalout = newtotal;
                    document.getElementById('total').nextElementSibling.value = '';
                };
                document.getElementById('total').value ="Fördersumme: " + euro(newtotalout);
                document.getElementById('total').dataset.out = newtotal;
            } else {
                document.getElementById('total').value = '';
                document.getElementById('total').dataset.out = 0;
            };
        };
    };

    
};


function euro(wert) { // Formatierung der Ausgabe in EURO
    wert = Number(wert).toFixed(2);
    wert = wert.replace(".",",");
    while(wert.match(/^(\d+)(\d{3}\b)/)) {
        wert = wert.replace(/^(\d+)(\d{3}\b)/, RegExp.$1 + '.' + RegExp.$2);
    }
    return wert + ' EUR';
}


function calc_option () { // Förderung des Freikühlers 
    let outputfield = document.getElementById('freikuehlout');
    if (outputfield) {
        let oldvalue = outputfield.dataset.out ? Number(outputfield.dataset.out) : 0;
        let err = false;
        let sum = 0;

        // Foerdersummen der Anlagenteile addieren
        let parts = document.getElementsByName('ruckkuehler');
        if (parts.length > 0) {
            for (let i = 0; i < parts.length; i++) {
                let v = Number(parts[i].dataset.out);
                if (isNaN(v)) v = 0;
                sum += v;
            }
        };
        let kaelteerzeuger = document.getElementsByName('kaelteerzeuger')[0] ? Number(document.getElementsByName('kaelteerzeuger')[0].nextSibling.nextSibling.dataset.out) : 0;
        sum += kaelteerzeuger; // Foerderung Kaelteerzeuger addieren
        sum = sum * 0.05; // 5% mehr Födereung

        set_output(sum, oldvalue, outputfield, err);
    }
}


document.addEventListener('DOMContentLoaded', function () { // Event erst hinzufügen wenn der DOM geladen ist

    create_block ();        // Auswahlfeld(er) laden
    create_tables ();       // Tabellen laden
    create_checkfields ();  // Auswahlfelder laden
    create_lists ();        // Optionslisten der Tabellen laden

});    

</script>
</html>